{"version":3,"file":"onuncaughtexception.js","sourceRoot":"","sources":["../../src/main/integrations/onuncaughtexception.ts"],"names":[],"mappings":";;;AAAA,uCAA6C;AAG7C,uCAAkC;AAElC,gCAAgC;AAChC,MAAa,mBAAmB;IAAhC;QAIE,kBAAkB;QACX,SAAI,GAAW,mBAAmB,CAAC,EAAE,CAAC;IAuC/C,CAAC;IArCC;;OAEG;IACI,SAAS;;QACd,MAAM,OAAO,GAAG,MAAA,IAAA,oBAAa,GAAE,CAAC,SAAS,EAAc,0CAAE,UAAU,EAAE,CAAC;QAEtE,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC,KAAY,EAAE,EAAE;YACtD,MAAM,IAAI,GAAG,IAAA,oBAAa,GAAE,CAAC,cAAc,CAAC,mBAAmB,CAAC,CAAC;YACjE,IAAI,IAAI,EAAE;gBACR,IAAA,oBAAa,GAAE,CAAC,SAAS,CAAC,CAAO,KAAK,EAAE,EAAE;oBACxC,KAAK,CAAC,iBAAiB,CAAC,CAAO,KAAY,EAAE,EAAE;wBAAC,OAAA,iCAC3C,KAAK,KACR,KAAK,EAAE,OAAO,IACd,CAAA;sBAAA,CAAC,CAAC;oBAEJ,MAAM,UAAU,GAAG,IAAA,oBAAa,GAAE,CAAC,SAAS,EAAgB,CAAC;oBAC7D,UAAU,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAE,iBAAiB,EAAE,KAAK,EAAE,EAAE,IAAA,oBAAa,GAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;oBAC7F,MAAM,UAAU,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,eAAe,IAAI,IAAI,CAAC,CAAC;oBAExE,IAAI,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,YAAY,EAAE;wBACzB,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;qBAC7B;yBAAM,IAAI,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE;wBACjE,8DAA8D;wBAC9D,0DAA0D;wBAC1D,sCAAsC;wBACtC,OAAO,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC;wBACrC,sCAAsC;wBACtC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;wBACrB,MAAM,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC;wBACxB,MAAM,KAAK,GAAG,GAAG,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,KAAK,KAAK,CAAC,OAAO,EAAE,CAAC;wBAC1E,MAAM,OAAO,GAAG,wBAAwB,KAAK,EAAE,CAAC;wBAChD,iBAAM,CAAC,YAAY,CAAC,iDAAiD,EAAE,OAAO,CAAC,CAAC;qBACjF;gBACH,CAAC,CAAA,CAAC,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;IACL,CAAC;;AA3CH,kDA4CC;AA3CC,kBAAkB;AACJ,sBAAE,GAAW,qBAAqB,CAAC","sourcesContent":["import { getCurrentHub } from '@sentry/core';\nimport { NodeClient } from '@sentry/node';\nimport { Event, Integration } from '@sentry/types';\nimport { dialog } from 'electron';\n\n/** Capture unhandled errors. */\nexport class OnUncaughtException implements Integration {\n  /** @inheritDoc */\n  public static id: string = 'OnUncaughtException';\n\n  /** @inheritDoc */\n  public name: string = OnUncaughtException.id;\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(): void {\n    const options = getCurrentHub().getClient<NodeClient>()?.getOptions();\n\n    global.process.on('uncaughtException', (error: Error) => {\n      const self = getCurrentHub().getIntegration(OnUncaughtException);\n      if (self) {\n        getCurrentHub().withScope(async (scope) => {\n          scope.addEventProcessor(async (event: Event) => ({\n            ...event,\n            level: 'fatal',\n          }));\n\n          const nodeClient = getCurrentHub().getClient() as NodeClient;\n          nodeClient.captureException(error, { originalException: error }, getCurrentHub().getScope());\n          await nodeClient.flush(nodeClient.getOptions().shutdownTimeout || 2000);\n\n          if (options?.onFatalError) {\n            options.onFatalError(error);\n          } else if (global.process.listenerCount('uncaughtException') <= 2) {\n            // In addition to this handler there is always one in Electron\n            // The dialog is only shown if there are no other handlers\n            // eslint-disable-next-line no-console\n            console.error('Uncaught Exception:');\n            // eslint-disable-next-line no-console\n            console.error(error);\n            const ref = error.stack;\n            const stack = ref !== undefined ? ref : `${error.name}: ${error.message}`;\n            const message = `Uncaught Exception:\\n${stack}`;\n            dialog.showErrorBox('A JavaScript error occurred in the main process', message);\n          }\n        });\n      }\n    });\n  }\n}\n"]}