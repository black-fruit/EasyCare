/**
 * @jest-environment jsdom
 */

import saveBlobAsFile from '../../../download-file/util/save-blob-as-file';

describe('测试 saveBlobAsFile 函数', () => {
  window.URL.createObjectURL = jest.fn();
  window.URL.revokeObjectURL = jest.fn();

  afterEach(() => {
    window.URL.createObjectURL.mockReset();
  });

  it('1. msSaveOrOpenBlob 存在', () => {
    Object.defineProperty(window.navigator, 'msSaveOrOpenBlob', {
      configurable: true,
      get() {
        return jest.fn()
      }
    })

    Object.defineProperty(window.navigator, 'msSaveBlob', {
      value: jest.fn()
    })


    saveBlobAsFile('', 'test.txt');
    expect(window.navigator.msSaveBlob).toBeCalled();
  })

  it('2. saveBlobAsFile 不存在', () => {
    Object.defineProperty(window.navigator, 'msSaveOrOpenBlob', {
      get() {
        return undefined
      }
    })


    saveBlobAsFile('', 'test.txt');
    expect(window.URL.createObjectURL).toBeCalled();
    expect(window.URL.revokeObjectURL).toBeCalled();
  })
})