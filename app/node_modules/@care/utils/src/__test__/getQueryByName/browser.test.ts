import getQueryByName from '../../getQueryByName';

describe('测试 getQueryByName 函数', () => {
  const search = '?courseId=123&uid=456&accessToken=789&appVersion=3.0.8.0-e2c16dd0e&app=true&courseId=456';
  
  it('1. 浏览器环境', () => {
    process.browser = true;
    expect(getQueryByName('appVersion', search)).toBe('3.0.8.0-e2c16dd0e');
    expect(getQueryByName('courseId', search)).toBe('123');
  })

  it('2. 不传search', () => {
    delete global.window.location;
    global.window = Object.create(window);
    const search = "?courseId=123&uid=456&accessToken=789&appVersion=3.0.8.0-e2c16dd0e&app=true";
    Object.defineProperty(window, "location", {
        value: {
          search
        },
        writable: true
    });

    expect(getQueryByName('accessToken')).toBe('789');
  })

  it('3. 传search，query不存在', () => {
    process.browser = true;
    global.window = Object.create(window);
    const search = "?courseId=123&uid=456&accessToken=789&appVersion=3.0.8.0-e2c16dd0e&app=true";
    expect(getQueryByName('random', search)).toBe(null);
  })

  it('4. 传search，自定义decodeFn', () => {
    process.browser = true;
    global.window = Object.create(window);
    const search = "?courseId=123&uid=456&accessToken=789&appVersion=3.0.8.0-e2c16dd0e&app=true";
    expect(getQueryByName('accessToken', search, decodeURIComponent)).toBe('789');
  })
})
