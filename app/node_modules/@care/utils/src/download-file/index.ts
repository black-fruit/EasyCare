import url2Blob from './util/url-to-blob';
import saveBlobAsFile from './util/save-blob-as-file';

type TDownloadFileOptions = {
  beforeDownload?: () => false | void;
  success?: () => void;
  fail?: (err: Error) => void;
  done?: () => void;
}

/**
* 下载文件
* @param  {String} url 目标文件地址
* @param  {String} filename 想要保存的文件名称
*/
const downloadFile = (url: string, filename: string, options: TDownloadFileOptions = {}) => {
  if(typeof window === 'undefined') {
    throw new Error('window is undefined');
  }
  const { beforeDownload, success, fail, done } = options;
  if((beforeDownload && beforeDownload()) === false) {
    return;
  }

  url2Blob(url)
  .then(blob => {
    saveBlobAsFile(blob, filename);
    success && success();
    done && done();
  })
  .catch(err => {
    console.error(err);
    fail && fail(err);
    done && done();
  })
}

export default downloadFile;
export { url2Blob, saveBlobAsFile }