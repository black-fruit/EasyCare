var electron=require("electron"),app=require("electron").app,IpcMain=require("electron").ipcMain,BrowserWindow=require("electron").BrowserWindow,Shell=require("electron").shell,globalShortcut=require("electron").globalShortcut,Event=require("../base/events"),EventProxy=require(APP_PATH+"/node_modules/eventproxy"),download=require("../components/Downloader").download,SystemInfo=require("../components/SystemInfo"),SystemUtils=require("../base/OSUtils"),Updater=require("../components/Updater"),WindowsCenter=require("../windows/WindowsCenter"),appStore=require("../components/app-store");const fridayReport=require("../components/friday-report"),{compareStrings:compareStrings}=require("@care/utils");var StartMainWindowEventProxy=new EventProxy;exports.StartMainWindowEventProxy=StartMainWindowEventProxy;const Strategy=require("./strategy");var appState=0,appVersionInfo={},stateMapping=require(`${APP_PATH}/config/state-mapping.json`),usbEntry=require(`${APP_PATH}/dll/usb`);require(`${APP_PATH}/dll/easiupdate`),require(`${APP_PATH}/dll/easiagent`);var EasiServerHandler=require("../components/EasiServerHandler")({host:"127.0.0.1",port:3123,appName:config.appName,appVersion:config.version,receiveDataHandler:receiveMsgFromEasiServer});const PROCESS_STATE={ON_CHECKING:0,ON_LOGIN:1,ON_MAIN:2,ON_HONOR:3,ON_MINIFY:4};process.state=PROCESS_STATE.ON_CHECKING;var getRemovableUsbData=function(){try{var n=usbEntry.getUsbDataFromRemovableDrives();if(""!==n){var o=JSON.parse(n);o.Name=o.Id,WindowsCenter.sendToWindow("login-window","usb-login",o)}}catch(n){console.log(n)}};IpcMain.on("start-usb-listening",(function(){getRemovableUsbData(),usbEntry.setUpDriveChangedCallBack(getRemovableUsbData)})),IpcMain.on("stop-usb-listening",(function(){usbEntry.clearDriveChangedCallBack()}));var LoginTimeoutChecking,cacheObj={};function updateMiniMedalWindowPosition(){var n=SystemInfo.externalDisplay.bounds.width,o=WindowsCenter.getWindow("honor-window"),e=o.getSize()[0],i=o.getPosition()[0],w=WindowsCenter.getWindow("mini-medal-picker-window"),t=w.getSize()[0],d=w.getPosition(),s=d[0],r=d[1];i-t>10?s=i-t-10:i+e+10+t<n&&(s=i+e+10),w.setPosition(parseInt(s),parseInt(r))}function updateRaffleWindowPosition(){var n=SystemInfo.externalDisplay.bounds.width,o=WindowsCenter.getWindow("honor-window"),e=o.getSize()[0],i=o.getPosition()[0],w=WindowsCenter.getWindow("raffle-window"),t=w.getSize()[0],d=w.getPosition(),s=d[0],r=d[1];i-t>10?s=i-t-10:i+e+10+t<n&&(s=i+e+10),w.setPosition(parseInt(s),parseInt(r))}function showLoginWindow(){WindowsCenter.showWindow("login-window"),WindowsCenter.setWindowAlwaysOnTop("login-window")}function showMainWindow(){hideWindowByOS("honor-window"),hideWindowByOS("honor-mini-window"),showWindowByOS("main-window"),WindowsCenter.hideWindow("raffle-window"),WindowsCenter.hideWindow("mini-medal-picker-window"),setTimeout((()=>{WindowsCenter.setWindowAlwaysOnTop("timer-window"),WindowsCenter.setWindowAlwaysOnTop("noise-window"),WindowsCenter.setWindowAlwaysOnTop("relay-window")}),500),process.state=PROCESS_STATE.ON_MAIN}function showHonorWindow(){hideWindowByOS("main-window"),hideWindowByOS("honor-mini-window"),showWindowByOS("honor-window"),WindowsCenter.openWindow("mini-medal-picker-window"),WindowsCenter.openWindow("raffle-window"),process.state=PROCESS_STATE.ON_HONOR}function showHonorMiniWindow(){hideWindowByOS("main-window"),hideWindowByOS("honor-window"),recalWindowPosition("honor-mini-window","show"),showWindowByOS("honor-mini-window"),process.state=PROCESS_STATE.ON_MINIFY}function showWindowByOS(n){WindowsCenter.showWindow(n)}function hideWindowByOS(n){WindowsCenter.hideWindow(n)}function recalWindowPosition(n,o){const e=SystemInfo.osStr,i=SystemInfo.externalDisplay.bounds.width,w=SystemInfo.externalDisplay.bounds.height,t=WindowsCenter.getWindow(n),d=t.width,s=t.height,r=t.getPosition(),a=r[0],c=r[1];let l={x:a,y:c};if("show"===o){if(e.toLowerCase().indexOf("windows_nt_10")>-1){const o=cacheObj[`${n}_position`];o&&(l={x:o.x,y:o.y},delete cacheObj[`${n}_position`])}l.x<0&&(l.x=0),l.x+d>i&&(l.x=i-d-40),l.y<0&&(l.y=0),l.y+s>w&&(l.y=w-s-40),t.setPosition(parseInt(l.x),parseInt(l.y))}else"hide"===o&&e.toLowerCase().indexOf("windows_nt_10")>-1&&void 0===cacheObj[`${n}_position`]&&(cacheObj[`${n}_position`]={x:a,y:c},t.setPosition(-100,-100))}function receiveMsgFromEasiServer(n,o){switch(console.log("id: ",n),console.log("content: ",o),n){case 600:activeProcessFromEasiServer(),responseActiveMsgToEasiServer()}}function activeProcessFromEasiServer(){switch(process.state){case PROCESS_STATE.ON_LOGIN:showLoginWindow();break;case PROCESS_STATE.ON_MAIN:case PROCESS_STATE.ON_HONOR:case PROCESS_STATE.ON_MINIFY:showMainWindow()}}function responseActiveMsgToEasiServer(){const n=config.version;let o=0;switch(process.state){case PROCESS_STATE.ON_CHECKING:case PROCESS_STATE.ON_LOGIN:o=0;break;case PROCESS_STATE.ON_MAIN:case PROCESS_STATE.ON_HONOR:o=1;break;case PROCESS_STATE.ON_MINIFY:o=2}EasiServerHandler.sendData(601,{state:o,version:n})}function closeAllWindows(){WindowsCenter.closeWindow("prechecking-window"),WindowsCenter.closeWindow("main-window"),WindowsCenter.closeWindow("honor-window"),WindowsCenter.closeWindow("honor-mini-window"),WindowsCenter.closeWindow("mini-medal-picker-window"),WindowsCenter.closeWindow("timer-window"),WindowsCenter.closeWindow("noise-window"),WindowsCenter.closeWindow("relay-window"),WindowsCenter.closeWindow("raffle-window"),WindowsCenter.closeWindow("change-theme-window")}function hideAllWindows(){WindowsCenter.hideWindow("prechecking-window"),WindowsCenter.hideWindow("main-window"),WindowsCenter.hideWindow("honor-window"),WindowsCenter.hideWindow("honor-mini-window"),WindowsCenter.hideWindow("mini-medal-picker-window"),WindowsCenter.hideWindow("about-me-window"),WindowsCenter.hideWindow("timer-window"),WindowsCenter.hideWindow("noise-window"),WindowsCenter.hideWindow("relay-window"),WindowsCenter.hideWindow("raffle-window"),WindowsCenter.hideWindow("change-theme-window")}function appQuit(){const n=SystemInfo.networkInterface||{},o=()=>{closeAllWindows(),log.info("退出程序"),app.quit()},{uid:e=""}=appStore.getItem("userInfo")||{};fridayReport("close_care_pc",{mac:n.mac,os:SystemInfo.osStr,tid:e}).then(o).catch(o)}function changeThemeToAllWindow(n){["main-window","honor-window","mini-medal-picker-window","about-me-window","change-theme-window","timer-window","noise-window","relay-window","raffle-window"].forEach((o=>{WindowsCenter.sendToWindow(o,"change-theme",n,!0)}))}IpcMain.on("app-quit",appQuit),IpcMain.on("store-user-info-to-main-thread",(function(n,o){appStore.setItem("userInfo",o)})),IpcMain.on("get-system-info",(function(n){const o=n.sender.browserWindowOptions.title;WindowsCenter.sendToWindow(o,"system-info-send",SystemInfo.networkInterface||{})})),IpcMain.on("app-online",(function(){log.info("当前服务可用正常使用");const n=WindowsCenter.getWindow("prechecking-window");try{n.webContents&&n.webContents.session&&n.webContents.session.clearStorageData({origin:"/",storages:["cookies"],quotas:["temporary","persistent","syncable"]})}catch(n){console.log(n)}WindowsCenter.getWindow("login-window")?WindowsCenter.reOpenWindow("login-window"):WindowsCenter.openWindow("login-window")})),IpcMain.on("app-offline",(function(){log.error("当前连接服务失败")})),IpcMain.on("app-version",(function(n,o){appVersionInfo.currentVersion=o.currentVersion,appVersionInfo.futureVersion=o.futureVersion,appVersionInfo.downloadUrl=o.downloadUrl,appVersionInfo.needRemind=o.needRemind,appVersionInfo.macAddress=o.macAddress,compareStrings(appVersionInfo.currentVersion,appVersionInfo.futureVersion)<0?appVersionInfo.hasUpdatePackages=!0:appVersionInfo.hasUpdatePackages=!1,Updater.setVersionInfo(appVersionInfo),appVersionInfo.needDownloadNewPackages=Updater.checkUpdate(),log.info(appVersionInfo)})),IpcMain.on("open-external-browser",(function(n,o){"string"==typeof o&&Shell.openExternal(o)})),IpcMain.on("open-screen-keyboard",(function(){SystemUtils.openScreenKeyboard()})),IpcMain.on("show-some-dev-tool",(function(n,o){WindowsCenter.getWindow(o).webContents.openDevTools()})),IpcMain.on("to-logout-status",(function(){appState=stateMapping.toLogout,hideAllWindows(),global.config.from="self",global.config.token="",WindowsCenter.openWindow("prechecking-window")})),IpcMain.on("open-login-window",(function(n,o){o&&(global.config.from=o),WindowsCenter.openWindow("login-window")})),IpcMain.on("close-login-window",(function(){WindowsCenter.closeWindow("login-window")})),IpcMain.on("open-tencent-login-window",(function(){WindowsCenter.openWindow("tencent-login-window")})),IpcMain.on("close-tencent-login-window",(function(){WindowsCenter.closeWindow("tencent-login-window")})),IpcMain.on("mini-main-window",(function(){WindowsCenter.hideWindow("main-window")})),IpcMain.on("max-main-window",(function(){WindowsCenter.showWindow("main-window")})),IpcMain.on("blur-main-window",(function(){WindowsCenter.blurWindow("main-window")})),IpcMain.on("open-main-window",(function(){cacheObj={},appState=stateMapping.toWork,Strategy.openMainWindow(null,closeAllWindows)})),IpcMain.on("show-honor-window",(function(){showHonorWindow()})),IpcMain.on("show-honor-window-without-animation",(function(){showHonorWindow()})),IpcMain.on("show-main-window",(function(){WindowsCenter.sendToWindow("raffle-window","stop-raffle"),WindowsCenter.sendToWindow("main-window","send-data-to-main-window"),showMainWindow()})),IpcMain.on("show-main-window-without-animation",(function(){showMainWindow()})),IpcMain.on("show-honor-mini-window",(function(n,o){let e=o||"";if(!e)try{e=n.sender.browserWindowOptions.title}catch(n){log.error(n)}WindowsCenter.sendToWindow("honor-mini-window","sender-to-show",e),showHonorMiniWindow()})),IpcMain.on("dragging-honor-mini-window",(function(n,o){void 0!==cacheObj.honorMiniWindowRePositingProcess&&clearTimeout(cacheObj.honorMiniWindowRePositingProcess);var e=WindowsCenter.getWindow("honor-mini-window"),i=e.getPosition(),w=e.getSize(),t=w[0],d=w[1],s=o.left,r=o.top,a=i[0],c=i[1],l=electron.screen.getAllDisplays(),W=SystemInfo.externalDisplay=l[0],p=W.bounds.width,h=W.bounds.height;s+a<=0?a=0:s+a+t>p?a=p-t:a+=s,r+c<=0?c=0:r+c+d>h?c=h-d:c+=r,e.setPosition(parseInt(a),parseInt(c))})),IpcMain.on("minimize-raffle-student-picker",(function(){WindowsCenter.hideWindow("mini-medal-picker-window")})),IpcMain.on("maximize-raffle-student-picker-window",(function(){WindowsCenter.showWindow("mini-medal-picker-window")})),IpcMain.on("open-medal-picker-window",(function(n,o){WindowsCenter.hideWindow("main-window"),updateMiniMedalWindowPosition(),WindowsCenter.showWindow("mini-medal-picker-window")})),IpcMain.on("update-medal-picker-window",(function(n,o){WindowsCenter.sendToWindow("mini-medal-picker-window","send-data-to-mini-medal-picker-window",o)})),IpcMain.on("set-medal-in-mini-medal-picker-window",(function(n,o){updateMiniMedalWindowPosition(),WindowsCenter.showWindow("mini-medal-picker-window"),WindowsCenter.hideWindow("main-window"),WindowsCenter.hideWindow("raffle-window");WindowsCenter.sendToWindow("mini-medal-picker-window","set-medal-in-mini-medal-picker-window",o)})),IpcMain.on("close-mini-medal-picker",(function(n,o){WindowsCenter.hideWindow("mini-medal-picker-window")})),IpcMain.on("open-about-me-window",(function(){const n=WindowsCenter.getWindow("about-me-window");n?n.show():Strategy.openSomeWindow("about-me-window",(()=>{WindowsCenter.showWindow("about-me-window"),WindowsCenter.setWindowAlwaysOnTop("about-me-window")}))})),IpcMain.on("close-about-me-window",(function(){Strategy.hideSomeWindow("about-me-window")})),IpcMain.on("open-change-theme-window",(function(){const n=WindowsCenter.getWindow("change-theme-window");n?n.show():Strategy.openSomeWindow("change-theme-window",(()=>{WindowsCenter.showWindow("change-theme-window"),WindowsCenter.setWindowAlwaysOnTop("change-theme-window")}))})),IpcMain.on("close-change-theme-window",(function(){Strategy.hideSomeWindow("change-theme-window")})),IpcMain.on("change-theme-to-all-window",(function(n,o){Strategy.set("currThemeInfo",o),changeThemeToAllWindow(o)})),IpcMain.on("show-timer-window",(function(n,o){const e=WindowsCenter.getWindow("timer-window");e?e.show():Strategy.openSomeWindow("timer-window",(()=>{WindowsCenter.showWindow("timer-window"),WindowsCenter.sendToWindow("timer-window","send-public-data-to-timer-window",o),WindowsCenter.setWindowAlwaysOnTop("timer-window")}))})),IpcMain.on("hide-timer-window",(function(){Strategy.hideSomeWindow("timer-window")})),IpcMain.on("show-noise-window",(function(){const n=WindowsCenter.getWindow("noise-window");n?n.show():Strategy.openSomeWindow("noise-window",(()=>{WindowsCenter.sendToWindow("noise-window","show-noise-window"),WindowsCenter.showWindow("noise-window"),WindowsCenter.setWindowAlwaysOnTop("relay-window")}))})),IpcMain.on("hide-noise-window",(function(){Strategy.hideSomeWindow("noise-window")})),IpcMain.on("show-relay-window",(function(n,o){const e=WindowsCenter.getWindow("relay-window");e?e.show():Strategy.openSomeWindow("relay-window",(()=>{WindowsCenter.sendToWindow("relay-window","show-relay-window",o),WindowsCenter.showWindow("relay-window"),WindowsCenter.setWindowAlwaysOnTop("relay-window")}))})),IpcMain.on("hide-relay-window",(function(){Strategy.hideSomeWindow("relay-window")})),IpcMain.on("set-main-window-to-top",(function(n,o){WindowsCenter.setWindowAlwaysOnTop("main-window")})),IpcMain.on("install-new-package",(function(){setTimeout((()=>{showHonorMiniWindow(),WindowsCenter.hideWindow("about-me-window")}),3e3),Updater.installNewPackage()})),IpcMain.on("hide-raffle-window",(function(){WindowsCenter.hideWindow("raffle-window"),WindowsCenter.sendToWindow("raffle-window","stop-raffle")})),IpcMain.on("minimize-raffle-window",(function(){WindowsCenter.hideWindow("raffle-window")})),IpcMain.on("maximize-raffle-window",(function(){WindowsCenter.showWindow("raffle-window")})),IpcMain.on("show-raffle-window",(function(){WindowsCenter.hideWindow("mini-medal-picker-window"),updateRaffleWindowPosition(),WindowsCenter.showWindow("raffle-window")})),IpcMain.on("send-classroom-data-to-honor-window",(function(n,o){let e="send-classroom-data-to-honor-window";WindowsCenter.sendToWindow("honor-window",e,o),WindowsCenter.sendToWindow("honor-mini-window",e,o)})),IpcMain.on("send-classroom-score-data-to-mini-honor-window",(function(n,o){WindowsCenter.sendToWindow("honor-mini-window","send-classroom-score-data-to-mini-honor-window",o)})),IpcMain.on("send-group-data-to-honor-window",(function(n,o){WindowsCenter.sendToWindow("honor-window","send-group-data-to-honor-window",o)})),IpcMain.on("send-student-data-to-honor-window",(function(n,o){WindowsCenter.sendToWindow("honor-window","send-student-data-to-honor-window",o)})),IpcMain.on("send-student-guide-data-to-honor-window",(function(n,o){WindowsCenter.sendToWindow("honor-window","send-student-guide-data-to-honor-window",o)})),IpcMain.on("send-raffle-request-to-main-window",(function(n,o){WindowsCenter.sendToWindow("main-window","send-raffle-request-to-main-window",o)})),IpcMain.on("send-raffle-response-to-raffle-window",(function(n,o){WindowsCenter.sendToWindow("raffle-window","send-raffle-response-to-raffle-window",o),updateRaffleWindowPosition(),WindowsCenter.showWindow("raffle-window"),WindowsCenter.hideWindow("mini-medal-picker-window")})),IpcMain.on("start-set-raffle-amount-on-raffle-window",(function(n,o){WindowsCenter.sendToWindow("raffle-window","start-set-raffle-amount-on-raffle-window",o),updateRaffleWindowPosition(),WindowsCenter.showWindow("raffle-window"),WindowsCenter.hideWindow("mini-medal-picker-window")})),IpcMain.on("send-user-data-to-honor-window",(function(n,o){if(cacheObj.userInfoToHonorWindow=o,!0===cacheObj["honor-window-ready-to-receive-msg"]){let n="send-user-data-to-honor-window";WindowsCenter.sendToWindow("honor-window",n,cacheObj.userInfoToHonorWindow)}})),IpcMain.on("honor-window-ready-to-receive-msg",(function(){if(void 0!==cacheObj.userInfoToHonorWindow&&null!==cacheObj.userInfoToHonorWindow){let n="send-user-data-to-honor-window";WindowsCenter.sendToWindow("honor-window",n,cacheObj.userInfoToHonorWindow)}else cacheObj["honor-window-ready-to-receive-msg"]=!0})),IpcMain.on("start-mini-medal-picker-window",(function(n,o){WindowsCenter.hideWindow("raffle-window"),WindowsCenter.sendToWindow("raffle-window","stop-raffle"),WindowsCenter.hideWindow("mini-medal-picker-window"),WindowsCenter.sendToWindow("main-window","start-mini-medal-picker-window",o)})),IpcMain.on("preview-images",(function(n,o){WindowsCenter.sendToWindow("raffle-window","preview-images",o)})),IpcMain.on("send-list-state-to-honor-window",(function(n,o){WindowsCenter.sendToWindow("honor-window","send-list-state-to-honor-window",o)})),IpcMain.on("send-list-state-to-main-window",(function(n,o){WindowsCenter.sendToWindow("main-window","send-list-state-to-main-window",o)})),IpcMain.on("stop-always-show-on-top",(function(){WindowsCenter.stopWindowAlwaysOnTopInterval("main-window")})),IpcMain.on("set-always-show-on-top",(function(){WindowsCenter.setWindowAlwaysOnTopInterval("main-window",[...Strategy.ALWAYS_ON_TOP_WINDOWS])})),IpcMain.on("main-window-to-refetch-class-info",(function(){WindowsCenter.sendToWindow("main-window","to-refetch-class-info")})),IpcMain.on("sso-login-info",(function(n,o){WindowsCenter.sendToWindow("login-window","login-info",o)})),Event.on("app-start",(function(){appState=stateMapping.starting;const n=SystemInfo.networkInterface||{};fridayReport("open_care_pc",{mac:n.mac,os:SystemInfo.osStr}),WindowsCenter.openWindow("prechecking-window"),globalShortcut.register("Alt+CommandOrControl+I",(()=>{const n=BrowserWindow.getFocusedWindow();n&&(require("devtron").install(),n.webContents.openDevTools())}))})),Event.on("error",(function(n){console.log(n),log.error(n)})),Event.on("prechecking-window-ready-to-show",(function(){WindowsCenter.showWindow("prechecking-window"),process.state=PROCESS_STATE.ON_CHECKING})),Event.on("prechecking-window-webContents-did-finish-load",(function(){if(WindowsCenter.setWindowAlwaysOnTop("prechecking-window"),appState===stateMapping.starting){var n=SystemInfo.networkInterface;WindowsCenter.sendToWindow("prechecking-window","start-program",n)}else appState===stateMapping.toLogout&&WindowsCenter.sendToWindow("prechecking-window","log-out")})),Event.on("tencent-login-window-ready-to-show",(function(){WindowsCenter.showWindow("tencent-login-window")})),Event.on("login-window-ready-to-show",(function(){closeAllWindows(),console.log("====================== login-window"),WindowsCenter.showWindow("login-window"),process.state=PROCESS_STATE.ON_LOGIN})),Event.on("login-window-webContents-did-finish-load",(function(){try{WindowsCenter.sendToWindow("login-window","system-info",{appVersion:appVersionInfo.currentVersion,osStr:SystemInfo.osStr,networkInterface:SystemInfo.networkInterface,screen:{width:SystemInfo.externalDisplay.bounds.width,height:SystemInfo.externalDisplay.bounds.height}})}catch(n){log.error(n)}})),Event.on("login-window-webContents-did-fail-load",(function(){WindowsCenter.reOpenWindow("login-window")})),Event.on("about-me-window-webContents-did-finish-load",(function(){function n(n){WindowsCenter.sendToWindow("about-me-window","update-download-package-status",n)}function o(n){Updater.updateDownloadedList(n.getFilename()),WindowsCenter.sendToWindow("about-me-window","stop-download-package")}WindowsCenter.sendToWindow("about-me-window","version-info",appVersionInfo),appVersionInfo.hasUpdatePackages&&(appVersionInfo.needDownloadNewPackages?(download(WindowsCenter.getWindow("about-me-window"),appVersionInfo.downloadUrl,{directory:Updater.downloadPath,onProgress:n}).then(o).catch(console.error),WindowsCenter.sendToWindow("about-me-window","start-download-package")):!0===appVersionInfo.needRemind&&(WindowsCenter.setWindowAlwaysOnTop("about-me-window"),WindowsCenter.showWindow("about-me-window")))})),Strategy.ALWAYS_ON_TOP_WINDOWS.forEach((n=>{Event.on(`${n}-ready-to-show`,(function(){console.log(`${n}-ready-to-show`),StartMainWindowEventProxy.emit(`${n}-ready-to-show`);const o=WindowsCenter.getWindow(n);try{!1===o.isVisible()&&o.show()}catch(n){console.log("windowName-ready-to-show error: ",n)}WindowsCenter.setWindowAlwaysOnTop(n)}))})),Event.on("main-window-ready-to-show",(function(){StartMainWindowEventProxy.emit("main-window-ready-to-show"),process.state=PROCESS_STATE.ON_MAIN})),["raffle-window","mini-medal-picker-window"].forEach((n=>{Event.on(`${n}-ready-to-show`,(function(){console.log(`${n}-ready-to-show`),StartMainWindowEventProxy.emit(`${n}-ready-to-show`),WindowsCenter.setWindowAlwaysOnTop(n)}))})),Event.on("main-window-close",(function(n,o){!1===o&&app.exit(0)})),Event.on("honor-window-ready-to-show",(function(){console.log("honor-window-ready-to-show");let n="send-user-data-to-honor-window";null===cacheObj.userInfoToHonorWindow||void 0===cacheObj.userInfoToHonorWindow?WindowsCenter.sendToWindow("honor-window",n,{userName:"希沃大师"}):WindowsCenter.sendToWindow("honor-window",n,cacheObj.userInfoToHonorWindow),StartMainWindowEventProxy.emit("honor-window-ready-to-show")})),Event.on("honor-window-show",(()=>{WindowsCenter.setWindowAlwaysOnTopInterval("honor-window",["mini-medal-picker-window","raffle-window"])})),Event.on("honor-window-moved",(function(n){clearTimeout(cacheObj.honorRePositionProcess),cacheObj.honorRePositionProcess=null;var o=WindowsCenter.getWindow("honor-window"),e=o.getPosition(),i=o.getSize(),w=i[0],t=(i[1],e[0]),d=e[1],s=electron.screen.getAllDisplays(),r=SystemInfo.externalDisplay=s[0],a=r.bounds.width;r.bounds.height;w-(t+w-a)<=190&&(n.preventDefault(),clearTimeout(cacheObj.honorRePositionProcess),cacheObj.honorRePositionProcess=setTimeout((function(){try{var n={x:a-60,y:d};o.setPosition(parseInt(n.x),parseInt(n.y))}catch(n){console.log(n)}}),200))})),Event.on("honor-mini-window-ready-to-show",(function(){console.log("honor-mini-window-ready-to-show"),WindowsCenter.setWindowAlwaysOnTopInterval("honor-mini-window"),StartMainWindowEventProxy.emit("honor-mini-window-ready-to-show")})),Event.on("tray-show-main-window",(function(){switch(process.state){case PROCESS_STATE.ON_MAIN:case PROCESS_STATE.ON_HONOR:case PROCESS_STATE.ON_MINIFY:WindowsCenter.sendToWindow("raffle-window","stop-raffle"),showMainWindow();break;case PROCESS_STATE.ON_LOGIN:showLoginWindow()}})),Event.on("tray-show-login-window",(function(){process.state===PROCESS_STATE.ON_LOGIN&&showLoginWindow()})),Event.on("app-restart",(function(){hideAllWindows();const n=WindowsCenter.getWindow("login-window");n&&n.hide(),Event.emit("app-start")})),Event.on("tray-app-quit",appQuit),module.exports=Event;