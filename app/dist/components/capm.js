const axios=require("axios").default,crypto=require("crypto"),config=global.config,logger=global.log,hash=crypto.createHash("md5"),appkey=config.capmId,version=config.version,version_value=Array.prototype.pop.call(config.version.split(".")),capmReport=e=>{const r={appkey:appkey,timestamp:Date.now(),version:version,version_value:version_value},o=Object.assign(r,e);return new Promise(((e,r)=>{console.log("before request"),axios({url:config.capmUrl,method:"POST",headers:{"X-Data-Id":"fe_monitor_e7a2cef6","Content-Type":"application/json"},data:[o],timeout:3e3}).then((r=>{console.log("request success"),logger.info(`${JSON.stringify(o)} report success!`),e(r)})).catch((e=>{logger.error(`${JSON.stringify(o)} report error!`),r(e)}))}))},reportError=e=>{const r={class:"unknown_exception",stacktrace:e instanceof Error?e.stack:"",stacktrace_digest:buildDigest(e instanceof Error?e.stack:e)};capmReport(r)},buildDigest=e=>{if(!e)return"";hash.update(e);const r=hash.digest("hex").substr(0,6);return e.split(/\n/)[0]+"+"+r};module.exports.reportError=reportError,module.exports.report=capmReport;