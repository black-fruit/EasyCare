"use strict";var fs=require("fs"),path=require("path"),util=require("util"),EOL=require("os").EOL,LEVELS=["error","warn","info","verbose","debug","silly"];module.exports.log=log,module.exports.format=formatFile,module.exports.appName=void 0,module.exports.transports={},module.exports.transports.console=transportConsole,module.exports.transports.console.format=formatConsole,module.exports.transports.console.level="silly",module.exports.transports.file=transportFile,module.exports.transports.file.format=formatFile,module.exports.transports.file.level="warning",module.exports.transports.file.maxSize=1048576,module.exports.transports.file.streamConfig=void 0,module.exports.findLogPath=findLogPath;for(var i=0;i<LEVELS.length;i++)module.exports[LEVELS[i]]=log.bind(module.exports,LEVELS[i]);function log(e,r){var t=Array.prototype.slice.call(arguments,1);t=t.map((function(e){return e instanceof Error?e.stack+EOL:e}));var o={level:e,text:r=util.format.apply(util,t),date:new Date},a=module.exports.transports;for(var n in a)if(a.hasOwnProperty(n)&&"function"==typeof a[n]&&compareLevels(a[n].level,e))try{a[n].call(module.exports,o)}catch(e){console.error("Logger Error: ",e)}}function compareLevels(e,r){var t=LEVELS.indexOf(e),o=LEVELS.indexOf(r);return-1===o||-1===t||o<=t}function transportConsole(e){var r=format(e,transportConsole.format||module.exports.format);console.log(r)}function ensurePath(e){const r=path.dirname(e);try{mkDir(r),fs.accessSync(r,fs.W_OK)}catch(e){return console.error("创建路径失败: ",r),""}return e}function mkDir(e,r){var t=e.split(path.sep);r=(r||"")+t.shift()+path.sep;try{fs.mkdirSync(r)}catch(e){if(!fs.statSync(r).isDirectory())throw new Error(e)}return!t.length||mkDir(t.join(path.sep),r)}function transportFile(e){var r=format(e,transportFile.format||module.exports.format);if(void 0===transportFile.stream){let e=transportFile.file&&ensurePath(transportFile.file);if(transportFile.file=""!==e?e:findLogPath(module.exports.appName),!transportFile.file)return transportFile.stream=!1,void log("warning","electron-log.transports.file: Could not set a log file");transportFile.maxSize>0&&logRotate(transportFile.file,transportFile.maxSize),transportFile.stream=fs.createWriteStream(transportFile.file,transportFile.streamConfig||{flags:"a"})}transportFile.stream&&transportFile.stream.write(r+EOL)}function logRotate(e,r){try{fs.statSync(e).size>r&&fs.renameSync(e,e.replace(/log$/,"old.log"))}catch(e){}}function findLogPath(e){if(!(e=e||function(){var e;try{var r=loadAppPackage();if(!r||!r.productName&&!r.name)return transportFile.stream=!1,log("warning","electron-log cannot read a name from package.json"),!1;e=r.productName||r.name}catch(e){return transportFile.stream=!1,log("warning","electron-log: "+e.message),!1}return console.log("appName: ",e),e}()))return!1;var r;switch(process.platform){case"linux":r=t(process.env.XDG_CONFIG_HOME,e).or(path.join(process.env.HOME,".config"),e).or(process.env.XDG_DATA_HOME,e).or(path.join(process.env.HOME,".local","share"),e).result;break;case"darwin":r=t(path.join(process.env.HOME,"Library","Logs"),e).or(path.join(process.env.HOME,"Library","Application Support"),e).result;break;case"win32":r=t(process.env.APPDATA,e).result}return!!r&&path.join(r,"log.log");function t(e,r){if(!this||this.or!==t||!this.result){if(!e)return{or:t};e=path.join(e,r);try{mkDir(e),fs.accessSync(e,fs.W_OK)}catch(e){return{or:t}}}return{or:t,result:!!this&&this.result||e}}}function loadAppPackage(){var e=r(path.dirname(require.main.filename))||r(process.cwd());return e?require(e):null;function r(e){for(var r;!r;){var t;r=path.join(e,"package.json");try{fs.statSync(r)}catch(o){t=path.resolve(e,".."),r=null}if(e===t)break;e=t}return r}}function format(e,r){if("function"==typeof r)return r(e);var t=e.date;return r.replace("{level}",e.level).replace("{text}",e.text).replace("{y}",t.getFullYear()).replace("{m}",pad(t.getMonth()+1)).replace("{d}",pad(t.getDate())).replace("{h}",pad(t.getHours())).replace("{i}",pad(t.getMinutes())).replace("{s}",pad(t.getSeconds())).replace("{ms}",pad(t.getMilliseconds(),4))}function formatConsole(e){return"["+(pad(e.date.getHours())+":"+pad(e.date.getMinutes())+":"+pad(e.date.getSeconds())+":"+pad(e.date.getMilliseconds(),4))+"] ["+e.level+"] "+e.text}function formatFile(e){return"["+(e.date.getFullYear()+"-"+pad(e.date.getMonth()+1)+"-"+pad(e.date.getDate())+" "+pad(e.date.getHours())+":"+pad(e.date.getMinutes())+":"+pad(e.date.getSeconds())+":"+pad(e.date.getMilliseconds(),4))+"] ["+e.level+"] "+e.text}function pad(e,r){return r=r||2,(new Array(r+1).join("0")+e).substr(-r,r)}